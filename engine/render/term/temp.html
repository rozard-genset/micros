<!-- globvar -->
{{- $render := "" -}}

{{- $themes := "default" -}}
{{- with .Site.Params.System.Themes -}}{{- $themes  = ( . | urlize ) -}}{{- end -}}

{{- $layout := "main" -}}
{{- with .Page.Params.Module.Layout -}}{{- $layout = ( . | urlize ) -}}{{- end -}}

{{- $module := "default" -}}
{{- with .Section -}}{{- $module  = ( . | urlize ) -}}{{- end -}}


<!-- models -->
{{- $based_theme := printf "themes/default/term/main/protos.html" -}}
{{- $theme_cores := printf "themes/%s/term/main/protos.html" $themes  -}}
{{- $theme_model := printf "themes/%s/term/%s/protos.html"   $themes  $layout -}}

{{- $modul_based := printf "module/default/term/main/protos.html" -}}
{{- $model_based := printf "module/default/term/%s/protos.html" $layout -}}
{{- $modul_cores := printf "module/%s/term/main/protos.html"    $module -}}
{{- $modul_model := printf "module/%s/term/%s/protos.html"      $module  $layout -}}

{{- $theme_modul := printf "themes/%s/module/%s/layout/term/main/protos.html" $themes  $module  -}}
{{- $theme_skins := printf "themes/%s/module/%s/layout/term/%s/protos.html"   $themes  $module  $layout -}}


<!-- module -->
{{- range ( slice $based_theme $theme_cores $theme_model $modul_based $modul_cores $modul_model $theme_modul $theme_skins ) -}}
    {{- if templates.Exists ( printf "partials/%s" . )  -}}
        {{- $render = . -}}
    {{- end -}}
{{- end -}}

<!-- blocks -->
{{- if .Page.Params.Blocks -}}
    {{- $render = printf "lib/blocks.html" -}}
{{- end -}}


<!-- render -->
{{- if templates.Exists ( printf "partials/%s" $render )  -}}

    {{- partial $render . -}}
{{- end -}}