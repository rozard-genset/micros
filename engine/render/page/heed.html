<!-- globvar -->
{{- $render := "" -}}

{{- $themes := "default" -}}
{{- with .Site.Params.System.Themes -}}{{- $themes  = ( . | urlize ) -}}{{- end -}}

{{- $layout := "main" -}}
{{- with .Page.Params.Module.Layout -}}{{- $layout = ( . | urlize ) -}}{{- end -}}

{{- $module := "default" -}}
{{- with .Section -}}{{- $module  = ( . | urlize ) -}}{{- end -}}


<!-- models -->
{{- $based_theme := printf "themes/default/page/main/layers.html" -}}
{{- $theme_cores := printf "themes/%s/page/main/layers.html" $themes   -}}
{{- $theme_model := printf "themes/%s/page/%s/layers.html"   $themes  $layout -}}

{{- $modul_based := printf "module/default/page/main/layers.html" -}}
{{- $model_based := printf "module/default/page/%s/layers.html" $layout -}}
{{- $modul_cores := printf "module/%s/page/main/layers.html" $module   -}}
{{- $modul_model := printf "module/%s/page/%s/layers.html"   $module  $layout -}}

{{- $theme_modul := printf "themes/%s/module/%s/layout/page/main/layers.html" $themes  $module  -}}
{{- $theme_skins := printf "themes/%s/module/%s/layout/page/%s/layers.html"   $themes  $module  $layout -}}


<!-- layout -->
{{- range ( slice $based_theme $theme_cores $theme_model $modul_based $modul_cores $modul_model $theme_modul $theme_skins ) -}}
    {{- if templates.Exists ( printf "partials/%s" . )  -}}
        {{- $render = . -}}
    {{- end -}}
{{- end -}}


<!-- render -->
{{- if templates.Exists ( printf "partials/%s" $render )  -}}
    {{- partial $render . -}}
{{- end -}}